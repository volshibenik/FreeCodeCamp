<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="skycons-master/skycons.js"></script>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<canvas id="icon1" width="128" height="128"></canvas>
	<canvas id="icon2" width="128" height="128"></canvas>
	<button class="btn-main" onclick="gettingJSON()">get T</button>
	<input type="button" class="btn-switch-temp" onclick="switchTemp(this)" value="Show in Fahrenheit">
	<p class="disp"></p>
	
	<script>
		//variables
		var jsonStr = "https://api.darksky.net/forecast/", 
				ke = ["e","1","7","f","6","8","c","6","c","b","b","e","1","0","c","0","1","6","e","2","a","f","d","d","1","4","d","0","2","5","5","a"], 
				exclude = "exclude=minutely,hourly,alerts,flags",
				units = "units=ca"
		;
		
		var skycons = new Skycons({"color" : "white"});

		function switchTemp (el) {
			if (el.value === 'Show in Celsius') {
				el.value = "Show in Fahrenheit";
			} 
			else {
				el.value = 'Show in Celsius';
			}
		}
		
		
		
		
		function timeConverter(UNIX_timestamp){
			var a = new Date(UNIX_timestamp * 1000);
			var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
			var month = months[a.getMonth()];
			var day = a.getDate();
			var hour = a.getHours();
			var min = a.getMinutes();
			var sec = a.getSeconds();
			var time = day +' ' + month + ' ' + hour + ':' + min + ':' + sec ;
			return time;
		}
		
		function gettingJSON(){

			var options = {
				enableHighAccuracy: true,
				timeout: 5000,
				maximumAge: 0
			};

			function success(pos) {
				var lat = pos.coords.latitude;
				var lon = pos.coords.longitude;

				makeJSON(lat,lon);
			};

			function error(err) {
				console.warn(`ERROR(${err.code}): ${err.message}`);
			};

			navigator.geolocation.getCurrentPosition(success, error, options);		
			
		}
			
			
		function makeJSON (lat, lon) {
			
			jsonStr +=ke.join('') + "/" + lat + "," + lon + "?" + exclude + "&" +units + "&" + "callback=?";
			
			/*var request = new XMLHttpRequest();
			
			request.open('GET', url);
			request.responseType = 'json';
			request.send();
			request.onload = function() {
				console.log(request.response);  //somehow this doesn't work but jquery $.getJSON does
			}*/
			
			makeThings(jsonStr);
			console.log(jsonStr);
		}
			
		function makeThings(jsonUrl) {	
			
			$.getJSON(jsonUrl, function(json) {
				
				
				var cur = json['currently'];
				var time = cur['time'];
				//var hourly = json['hourly']['data'];
			//	var time =hourly[47]['time'];
				var formattedTime = timeConverter(time);
				
				var icon = cur['icon'];
				
				skycons.add("icon1", icon);
				skycons.add(document.getElementById("icon2"), icon);

				
				$('.disp').html(json.timezone + '<br>' + cur['temperature'] + ' C' +  '<br>' + formattedTime );
				skycons.play();
			});
			
			
		}
		
		
	
	
	</script>
	<!--aeris weather   
login 
ZHDYPPNKuXJNHuVVuQfFA
Secret Key
qcyFeaGRbwtbnrh5HS6sBzOPtTNkvIw2xAP8zAYf
https://stackoverflow.com/questions/3076414/ways-to-circumvent-the-same-origin-policy
	-->

</body>
</html>