<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>twitch API</title>
</head>
<body>
	<ul class="channel-list">
		
	</ul>
	
	
	
	<script>
		const jsonStr  = "https://wind-bow.glitch.me/twitch-api/",
					list = document.querySelector('.channel-list');
		console.log(list);
		var streams = "streams/",
				channels = "channels/",
		 		arr= ["thijshs", "silvername", "playhearthstone", "ESL_SC2", "OgamingSC2", "cretetion", "freecodecamp", "habathcx", "RobotCaleb", "noobs2ninjas"];
		
		function buildList(streamer) {
			
			var request = new XMLHttpRequest();
			request.open('GET', jsonStr + channels + streamer, true);
			request.onload = function() {
				if (this.status >= 200 && this.status < 400) {
					
					var myData = JSON.parse(this.response);
					var myLi = document.createElement('li');
					var myImg = document.createElement('img');
					myLi.textContent = myData['display_name'];
					myLi.setAttribute('class', streamer);
					myImg.setAttribute('src', myData['logo']);
					myLi.appendChild(myImg);
					list.appendChild(myLi);
				} 
			};
			request.send();
		}
		
		function process_request(streamer) {
			var request = new XMLHttpRequest();
			request.open('GET', jsonStr+streams+streamer, true);
			request.onload = function() {
				if (this.status >= 200 && this.status < 400) {
					// Success!
					var data = JSON.parse(this.response);
					if (data['stream'] !== null) {
						console.log(data['stream']['channel']['display_name'], ' : ', data['stream']['viewers']);
						var targetLi = document.querySelector('.'+streamer);
						targetLi.classList.add('active');
					}
					
				} else {
					// We reached our target server, but it returned an error
					console.log('errorrr!');
				}
			};

			request.onerror = function() {
				console.log('eeee');
			};

			request.send();

		} /*end process_request*/
		
		for (var i = 0; i < arr.length; i++) {
		 buildList(arr[i]);
		}
		for (var i = 0; i < arr.length; i++) {
		 process_request(arr[i]);
		}
		 
		
		
		
		
		
		
		
	</script>
</body>
</html>